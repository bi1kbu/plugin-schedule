# Halo 系列小组件统一约束规范（v2）

## 1. 文档定位
- 目标：为“系列化页面小组件”提供统一的设计、结构、接口与交付标准。
- 适用对象：后端 API、后台管理页、编辑器节点、前台 Web Component、主题适配。
- 术语：
  - `MUST`：强制。
  - `SHOULD`：建议，偏离需记录原因。

## 2. 统一设计令牌（Design Tokens）

### 2.1 基础尺寸
- 基准栅格：`8px`。
- 间距序列：`4 / 8 / 12 / 16 / 24 / 32`。
- 圆角序列：
  - `--widget-radius-xs: 6px`
  - `--widget-radius-sm: 8px`
  - `--widget-radius-md: 10px`
  - `--widget-radius-lg: 12px`
  - `--widget-radius-xl: 14px`

### 2.2 字号与行高
- 页面标题：`28px`，`line-height: 1.25`，`font-weight: 700`。
- 卡片标题：`18px`，`line-height: 1.4`，`font-weight: 600`。
- 区块标题：`16px`，`line-height: 1.4`，`font-weight: 600`。
- 正文：`14px`，`line-height: 1.6`。
- 辅助文本：`12px`，`line-height: 1.5`。

### 2.3 表单控件规范
- 输入框/下拉/日期控件高度：`36px`（MUST）。
- 紧凑模式（仅后台列表筛选区可选）：`32px`（SHOULD）。
- 按钮高度：
  - 默认：`36px`
  - 小按钮：`32px`
- 输入框内边距：`0 10px`。
- 标签与控件垂直间距：`4px`。

## 3. 颜色与明暗主题规范

### 3.1 变量命名
- `MUST` 使用 `--halo-sw-*` 前缀（系列统一）。
- 必备变量：
  - 主色：`--halo-sw-primary-1/2/3-color`
  - 文本：`--halo-sw-text-1/2/3-color`
  - 背景：`--halo-sw-surface-1/2-color`
  - 边框：`--halo-sw-muted-1/2/3-color`
  - 强调：`--halo-sw-highlight-bg/border/marker-color`

### 3.2 明暗切换
- `MUST` 支持：
  - `prefers-color-scheme: dark` 兜底。
  - 主题外部覆盖：`.color-scheme-light/.color-scheme-dark` 或 `:root[data-color-scheme='light|dark']`。
- 对比度要求（MUST）：
  - 正文字体与背景 `>= 4.5:1`。
  - 大号文字（>=18px）与背景 `>= 3:1`。

## 4. 后台管理页面规范

### 4.1 菜单分级（MUST）
- 一级菜单：系列域（例如 `日程`）。
- 二级菜单：按“配置/数据管理”拆分（例如 `日历配置`、`日程管理`）。
- 三级页签：页面内子流程（例如 `列表`、`新建`、`统计`）。
- 菜单命名要求：
  - 使用名词短语，2~6 个汉字。
  - 同层同类语义（禁止一层里混“动作+名词”）。

### 4.2 页面布局
- 主内容最大宽度：`1280px`（MUST，后台大屏）。
- 页面左右内边距：`24px`（>=1200px），`16px`（<1200px）。
- 卡片间距：`16px`。
- `header-row` 外边距：上 `8px`，左 `8px`（系列统一）。

### 4.3 列表页
- 筛选区与表格区分离（MUST）。
- 筛选区高度建议：单行控件 `36px`。
- 表格行高：`44px ~ 48px`。
- 操作列按钮间距：`8px`。

### 4.4 新建/编辑页
- 卡片分区建议顺序：
  1. 关联数据（如关联文章）
  2. 基础信息
  3. 行为开关/高级设置
- 必填项标识：标签后缀“（必填）”。
- 选填项不写“非必填”。

## 5. 编辑器节点（小组件配置面板）规范

### 5.1 节点结构（MUST）
- 两行布局：
  - 第一行：组件名称（左）+ 核心开关（右）
  - 第二行：数据源选择 + 样式选择
- 配置区与预览区分层展示。

### 5.2 节点控件尺寸
- 第二行选择器最小宽度：
  - 数据源选择器：`220px`
  - 样式选择器：`160px`
- 节点容器圆角：`10px`。
- 节点边框：`1px`，选中态改 `2px` ring。

### 5.3 预览要求
- `MUST` 在选择数据后立即给出可见预览。
- 预览至少包含：标题区 + 主内容占位 + 辅助区占位。
- 空状态文案：明确说明“请先选择数据源”。

## 6. 前台 Web Component 规范

### 6.1 结构锚点（MUST）
- 主容器必须包含：
  - `data-widget="<code>"`
  - `data-widget-style="<style>"`
- 常规语义 class：`.title` `.wrap` `.card` `.head` `.item`。

### 6.2 模块宽度与布局
- 默认双栏：左 `2fr`，右 `1fr`（MUST）。
- 栏间距：`16px ~ 20px`。
- 卡片内边距：`14px`（可在移动端降到 `10px`）。
- 移动端断点：`<=960px` 切单栏。

### 6.3 边距与圆角
- 模块外层标题下边距：`12px ~ 16px`。
- 卡片圆角：`12px`。
- 基础控件圆角：`10px`。
- 强交互控件（胶囊按钮）圆角：`999px`。

### 6.4 交互与状态
- 必备状态：`loading / empty / error / selected / highlighted`。
- 鼠标悬停反馈：
  - 边框色变化或阴影变化（二选一至少实现一项）。
- 切换规则：滚动、点击、跳转等行为要有明确触发边界并可复述。

## 7. 接口与属性统一

### 7.1 前台属性（MUST）
- `show-title`: `true|false`
- `render-style`: 默认 `default`（扩展样式时新增枚举）
- 数据源主键属性：例如 `calendar-name`

### 7.2 编辑器属性映射（MUST）
- `parseHTML` 与 `renderHTML` 可逆。
- 未识别样式值必须回退到 `default`。
- 新增属性需保证旧文章可渲染。

### 7.3 后端接口
- 列表接口必须支持分页：`page`、`size`。
- 业务筛选参数必须可组合（如时间范围 + 关键字 + 状态）。
- 建议提供聚合字段（如范围、计数）供前台直接使用。

## 8. 小组件系列扩展规则
- 新增样式：先加枚举，再加渲染分支，再加文档与验收用例。
- 删除样式：先标记废弃至少一个版本周期，再移除。
- 新组件立项时必须复制本规范并填“组件差异表”。

## 9. 验收标准（发布门槛）
- 功能一致性：
  - [ ] 前后台属性映射一致。
  - [ ] 默认值与回退逻辑一致。
- 视觉一致性：
  - [ ] 间距、字号、控件高度符合本规范。
  - [ ] 明暗主题下对比度达标。
- 交互一致性：
  - [ ] 关键状态可见。
  - [ ] 编辑器配置区两行结构一致。
- 工程质量：
  - [ ] 构建通过。
  - [ ] 关键页面 MCP 可访问。

## 10. plugin-schedule 当前对照
- 已对齐：
  - 颜色变量与暗色兜底
  - 节点两行布局
  - `show-title` / `render-style` 属性通道
  - 主容器锚点：`data-widget="schedule"`、`data-widget-style`
- 后续建议：
  - 同系列新插件直接继承本规范，并在 README 增补“差异项”。
