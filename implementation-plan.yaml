元信息:
  项目: plugin-schedule
  版本: 1
  负责人: bi1kbu
  最后更新: 2026-02-08
  默认状态: 待开始
  状态枚举:
    - 待开始
    - 进行中
    - 阻塞
    - 已完成
  执行规则: "任一时刻只允许一个步骤处于进行中。"
  完成规则: "必须先将当前步骤标记为已完成，才能开始下一步。"

流程控制:
  工作流模式: 顺序执行
  完成步骤后必须更新状态: true
  更新状态后必须读取下一步: true
  停止条件: 全部步骤已完成
  阻塞处理策略: "若发生阻塞，状态设为阻塞，并在备注写明阻塞原因；解决后再继续。"

步骤:
  - 编号: M1
    标记: 初始化
    标题: 插件脚手架与本地运行
    状态: 已完成
    优先级: 高
    描述: "初始化插件骨架，验证 haloServer 可启动，并确认构建产物可生成。"
    交付物:
      - "项目结构创建完成"
      - "haloServer 可运行"
      - "Jar 构建通过"
    备注: "已完成脚手架初始化，`gradlew build` 通过，并验证 `haloServer` 可启动。"

  - 编号: M2
    标记: 后端
    标题: 领域模型与 API
    状态: 已完成
    优先级: 高
    描述: "实现 ScheduleCalendar 与 ScheduleEvent 扩展、索引、服务层与公开/自定义端点。"
    交付物:
      - "扩展模型与索引注册完成"
      - "增删改查与查询 API 完成"
      - "角色模板与反向代理配置完成"
    备注: "已实现 ScheduleCalendar/ScheduleEvent 扩展、索引注册、查询对象、服务层与公开端点。"

  - 编号: M3
    标记: 管理端界面
    标题: 后台管理 UI
    状态: 已完成
    优先级: 高
    描述: "实现日程组件配置页与事件管理页，支持关联文章选择。"
    交付物:
      - "组件配置列表/编辑界面"
      - "事件列表/编辑界面"
      - "关联文章流程"
    备注: "已实现后台日历配置页与事件管理页，支持事件与文章信息关联字段维护。"

  - 编号: M4
    标记: 编辑器扩展
    标题: 富文本编辑器区块集成
    状态: 已完成
    优先级: 中
    描述: "新增 schedule-view 区块节点、工具箱入口、气泡菜单与节点预览。"
    交付物:
      - "可插入的编辑器区块"
      - "区块属性可编辑"
      - "编辑器内预览可用"
    备注: "已实现富文本 `schedule-view` 区块，包含命令菜单、工具箱与节点属性编辑。"

  - 编号: M5
    标记: 前台组件
    标题: 日程展示组件
    状态: 已完成
    优先级: 高
    描述: "使用 Lit 开发前台组件，完成月历与 upcoming 面板展示并适配主题。"
    交付物:
      - "schedule.umd.js"
      - "月历 + upcoming 渲染"
      - "响应式布局支持"
    备注: "已提供前台 `schedule.umd.js` 组件，支持月历展示、日期筛选与 upcoming 列表。"

  - 编号: M6
    标记: 测试与发布
    标题: 质量验证、打包与发布验收
    状态: 已完成
    优先级: 高
    描述: "验证权限、时区、跨月边界，完成打包并在 Halo 中安装验收。"
    交付物:
      - "测试清单执行完成"
      - "构建产物验证完成"
      - "安装与冒烟测试完成"
    备注: "已完成构建与测试验收；处理容器名冲突后成功启动 Halo 开发容器进行冒烟验证。"

  - 编号: M7
    标记: 菜单重构
    标题: 日程父菜单与子菜单结构调整
    状态: 已完成
    优先级: 高
    描述: "将现有平级菜单重构为 `日程` 一级菜单，并挂载 `日历配置`、`日程事件` 两个子菜单。"
    交付物:
      - "日程父路由与布局页"
      - "两个子菜单可见且可切换"
      - "父级页面显示日历切换控件"
    备注: "已改为父路由 `日程` + 子菜单 `日历配置/日程事件`，并新增布局页显示日历切换控件。"

  - 编号: M8
    标记: 表单重构
    标题: 编辑操作改为页面控件
    状态: 已完成
    优先级: 高
    描述: "去除 prompt 交互，改为页面内表单进行新建、编辑和关联操作。"
    交付物:
      - "日历配置页面内表单"
      - "日程事件页面内表单"
      - "关联文章手动选择控件"
    备注: "已将日历和事件编辑改为页面内表单控件，移除 prompt 交互并支持手动文章选择。"

  - 编号: M9
    标记: 事件规则
    标题: 事件字段与突出显示规则
    状态: 已完成
    优先级: 高
    描述: "支持开始时间必填、结束时间选填、互斥突出显示开关，未指定时跟随关联文章置顶属性。"
    交付物:
      - "后端字段扩展"
      - "前端表单校验与互斥逻辑"
      - "前台组件突出显示渲染"
    备注: "已实现开始时间必填、结束时间选填、互斥突出显示开关，并在前台组件应用文章置顶兜底规则。"

  - 编号: M10
    标记: 验证
    标题: 构建与功能回归验证
    状态: 已完成
    优先级: 高
    描述: "执行构建与基础运行验证，确认菜单、表单与事件规则可用。"
    交付物:
      - "gradlew build 通过"
      - "关键页面可访问"
      - "计划状态回写完成"
    备注: "已完成构建验证并通过 Chrome MCP 冒烟测试：菜单层级、页面表单、互斥突出显示逻辑均生效。"

  - 编号: M11
    标记: 编辑器样式
    标题: 小组件入口样式统一
    状态: 已完成
    优先级: 高
    描述: "将编辑器工具箱中的 `插入日程` 入口改为与系统组件一致的样式。"
    交付物:
      - "使用统一 ToolboxItem 风格"
      - "入口图标与标题统一"
    备注: "已改用富文本编辑器 `ToolboxItem`，入口样式和系统组件保持一致。"

  - 编号: M12
    标记: 编辑器交互
    标题: 日历选择方式优化
    状态: 已完成
    优先级: 高
    描述: "将小组件中的手动输入日历名称改为下拉选择，并保持编辑器预览区一致性。"
    交付物:
      - "下拉选择日历"
      - "移除手输日历名"
      - "预览提示与状态优化"
    备注: "已将节点配置改为下拉选择日历，并移除手动输入日历名称的交互路径。"

  - 编号: M13
    标记: 编辑器可用性
    标题: 删除按钮修复与回归
    状态: 已完成
    优先级: 高
    描述: "修复小组件删除按钮无效问题，完成编译和页面冒烟验证。"
    交付物:
      - "删除按钮可用"
      - "gradlew build 通过"
      - "编辑器内操作验证通过"
    备注: "已修复删除按钮无效问题并完成构建与编辑器实测：插入入口样式统一、日历下拉选择可用、删除生效。"

  - 编号: M14
    标记: 配置精简
    标题: 日历名称与默认视图字段调整
    状态: 已完成
    优先级: 高
    描述: "前台标题改为后台日历名称，移除默认视图配置能力与相关界面项。"
    交付物:
      - "前台标题使用日历 displayName"
      - "默认视图字段从配置页移除"
      - "后端日历模型移除 defaultView"
    备注: "已移除 defaultView 配置项（后端模型+管理页），前台标题改为后台日历 displayName。"

  - 编号: M15
    标记: 前台交互
    标题: 日历滚动与快速跳转
    状态: 已完成
    优先级: 高
    描述: "支持上一月/下一月之外的日期快速跳转，并支持日历区域上下滚动切月。"
    交付物:
      - "日期选择快速跳转"
      - "日历区域滚轮切月"
      - "切月后渲染一致"
    备注: "已实现日期快速跳转（日期选择器+跳转按钮+今天）及日历区域滚轮上下切月。"

  - 编号: M16
    标记: 前台样式
    标题: 日历与右侧列表颜色标记优化
    状态: 已完成
    优先级: 高
    描述: "有日程日期显示底色，高亮/置顶日程使用单独高亮色，右侧日程卡片颜色保持一致。"
    交付物:
      - "日历天方块底色标记"
      - "高亮日程专色标记"
      - "右侧卡片对应色渲染"
    备注: "已实现天格底色区分：普通日程与高亮日程分别使用不同颜色，右侧列表颜色同步。"

  - 编号: M17
    标记: 回归验证
    标题: 构建与组件功能回归
    状态: 已完成
    优先级: 高
    描述: "执行构建并用 Chrome MCP 回归验证日程组件新行为。"
    交付物:
      - "gradlew build 通过"
      - "组件标题与交互验证通过"
      - "计划状态回写完成"
    备注: "已通过 gradlew build，并用 Chrome MCP 回归：标题取日历名、颜色规则、快速跳转、滚轮切月均可用。"

  - 编号: M18
    标记: 前台交互修正
    标题: Upcoming 固定与按周滚动
    状态: 已完成
    优先级: 高
    描述: "未选中具体日期时，Upcoming 列表不随日历滚动变化；滚轮滚动改为按周平移。"
    交付物:
      - "Upcoming 与滚动日历解耦"
      - "滚轮一次移动一周"
      - "多月连续视图效果"
    备注: "已改为连续 6 周视图与滚轮按周平移；未选中日期时 Upcoming 使用固定时间范围数据，不再随滚动变化。"

  - 编号: M19
    标记: 前台验证
    标题: 跳转与列表行为回归
    状态: 已完成
    优先级: 高
    描述: "验证快速跳转、按周滚动、未选中日期时 Upcoming 固定展示。"
    交付物:
      - "Chrome MCP 行为验证"
      - "主要交互录像式复现记录（备注）"
      - "无明显回归"
    备注: "Chrome MCP 验证结果：无选中日期时滚轮前后首日由 2026-02-09 -> 2026-02-16（按周平移），Upcoming 固定范围与列表不变；跳转到 2026-03-09 生效；点击 2026-02-12 后右侧切为按日筛选。"

  - 编号: M20
    标记: 构建验收
    标题: 编译与发布前检查
    状态: 已完成
    优先级: 高
    描述: "执行构建并完成计划状态落盘。"
    交付物:
      - "gradlew build 通过"
      - "计划步骤状态完整"
      - "变更说明输出"
    备注: "已执行 `gradlew build` 并通过；计划步骤 M1-M20 状态已全部落盘，当前可进入后续细节迭代。"

  - 编号: M21
    标记: 前台交互修正
    标题: 滚动与列表刷新解耦
    状态: 已完成
    优先级: 高
    描述: "鼠标滚轮仅移动日历窗口，不触发 Upcoming/右侧列表刷新。"
    交付物:
      - "滚轮不触发右侧加载态"
      - "滚轮不改动右侧当前列表内容"
      - "左侧日历按周滚动保持可用"
    备注: "已将右侧面板刷新状态与日历滚动解耦：滚轮按周滚动仅更新左侧日历，不再触发右侧加载态与列表变更。"

  - 编号: M22
    标记: 前台交互修正
    标题: 点击与跳转触发刷新
    状态: 已完成
    优先级: 高
    描述: "仅在点击某天或跳转到某天时刷新右侧列表。"
    交付物:
      - "点击日期刷新右侧列表"
      - "跳转日期刷新右侧列表"
      - "列表副标题与筛选状态正确"
    备注: "已新增按天刷新逻辑：点击日历天格会刷新右侧为该日事件；跳转日期会定位日历并刷新右侧为跳转日事件。"

  - 编号: M23
    标记: 回归验收
    标题: 构建与行为验证
    状态: 已完成
    优先级: 高
    描述: "执行构建并通过 Chrome MCP 回归验证新交互规则。"
    交付物:
      - "gradlew build 通过"
      - "滚动不刷新列表验证通过"
      - "点击/跳转刷新列表验证通过"
    备注: "已通过 `gradlew build`；Chrome MCP 验证：滚轮后首日变化但右侧副标题/列表不变且无加载态，跳转 `2026-02-10` 与点击 `2026-02-12` 均会刷新右侧列表。"

  - 编号: M24
    标记: 前台样式修正
    标题: 跨月天格统一亮色与月份文案简化
    状态: 已完成
    优先级: 高
    描述: "跨月天格不再灰显，顶部仅显示当前月份，不显示区间月份。"
    交付物:
      - "跨月天格取消灰色样式"
      - "顶部月份改为当前月格式"
      - "滚动与点击交互保持不变"
    备注: "已移除跨月天格灰显逻辑并统一天格基础样式；顶部月份改为仅显示当前月（YYYY-MM）。"

  - 编号: M25
    标记: 回归验收
    标题: 构建与页面验证
    状态: 已完成
    优先级: 高
    描述: "执行构建并验证视觉与文案调整效果。"
    交付物:
      - "gradlew build 通过"
      - "跨月天格视觉验证通过"
      - "顶部月份文案验证通过"
    备注: "已通过 `gradlew build`；Chrome MCP 验证顶部月份为 `2026-02` 且不含区间分隔，跨月天格（如 2026-03-01）与当月天格背景/文字颜色一致。"

  - 编号: M26
    标记: 前台交互增强
    标题: 月份选择与 Upcoming 重置入口
    状态: 已完成
    优先级: 高
    描述: "移除上方日期输入框，改为点击中间月份弹出年月选择；点击 Upcoming 标题恢复全量即将发生日程。"
    交付物:
      - "移除日期输入框与跳转按钮"
      - "中间月份点击弹出年月选择"
      - "点击 Upcoming 可清空日期筛选并恢复全量列表"
    备注: "已移除日期输入框与跳转按钮；改为点击中间月份触发年月选择（type=month）；新增点击 Upcoming 标题恢复全量即将发生日程。"

  - 编号: M27
    标记: 回归验收
    标题: 构建与交互验证
    状态: 已完成
    优先级: 高
    描述: "执行构建并验证月份选择与 Upcoming 重置行为。"
    交付物:
      - "gradlew build 通过"
      - "月份选择交互验证通过"
      - "Upcoming 重置行为验证通过"
    备注: "已通过 `gradlew build`；Chrome MCP 验证旧日期输入/跳转按钮已移除，月份改为点击中部按钮+年月选择，点击 Upcoming 可将 `当前筛选` 恢复为固定范围并显示全量即将发生日程。"

  - 编号: M28
    标记: 前台展示精简
    标题: 日程卡片移除时间信息
    状态: 已完成
    优先级: 高
    描述: "右侧日程卡片仅保留日期与标题，移除时间行。"
    交付物:
      - "卡片模板移除时间行"
      - "样式清理无用时间样式"
      - "卡片显示只含日期与标题"
    备注: "已精简卡片模板，仅保留日期与标题；时间行与附加信息行已移除。"

  - 编号: M29
    标记: 回归验收
    标题: 构建与页面验证
    状态: 已完成
    优先级: 高
    描述: "执行构建并验证卡片字段精简效果。"
    交付物:
      - "gradlew build 通过"
      - "卡片时间信息已移除"
      - "日期与标题显示正常"
    备注: "已通过 `gradlew build`；Chrome MCP 验证卡片仅包含 `date` 与 `name`，`.time`/`.post` 元素均不存在。"

  - 编号: M30
    标记: 配置改造
    标题: 移除 Slug 并新增标题显示开关
    状态: 已完成
    优先级: 高
    描述: "移除日历配置中的 Slug 字段，新增控制前台是否显示日历名称的开关。"
    交付物:
      - "日历配置页移除 Slug 输入与列表列"
      - "日历模型新增 showCalendarTitle 开关"
      - "前台组件按开关决定是否渲染标题"
    备注: "已移除 Slug（后端模型/索引、类型与配置页列/表单）；新增 `showCalendarTitle` 开关并接入前台标题渲染；同时修复日历更新请求需携带 `metadata.version` 的 500 问题。"

  - 编号: M31
    标记: 回归验收
    标题: 构建与功能验证
    状态: 已完成
    优先级: 高
    描述: "执行构建并验证 Slug 移除与标题开关生效。"
    交付物:
      - "gradlew build 通过"
      - "配置页不再出现 Slug"
      - "前台标题开关行为正确"
    备注: "已通过 `gradlew build`；Chrome MCP 验证后台无 Slug 且存在“前台显示日历名称”开关；关闭开关后前台标题隐藏，重新开启后标题恢复显示。"

  - 编号: M32
    标记: 前台样式优化
    标题: monthTrigger 月份选择器样式统一
    状态: 已完成
    优先级: 高
    描述: "将 monthTrigger 触发的月份选择改为与组件风格一致的自定义选择面板。"
    交付物:
      - "移除原生 month 输入交互样式依赖"
      - "新增统一风格的年月选择弹层"
      - "保持月份切换能力可用"
    备注: "已将 monthTrigger 改为统一风格按钮，月份选择改为自定义弹层（标题、年份/月份标签、统一按钮和焦点态），与组件卡片视觉风格一致。"

  - 编号: M33
    标记: 回归验收
    标题: 构建与样式验证
    状态: 已完成
    优先级: 高
    描述: "执行构建并验证新月份选择器样式与交互行为。"
    交付物:
      - "gradlew build 通过"
      - "月份选择器样式与组件一致"
      - "选择月份后视图切换正常"
    备注: "已通过 `gradlew build`；Chrome MCP 在本地预览页验证 monthTrigger 可打开/关闭自定义年月面板，样式与卡片体系一致，选择 2027-05 后触发器文案可正确切换。"

  - 编号: M34
    标记: 前台交互优化
    标题: 年月面板简化与跨度约束
    状态: 已完成
    优先级: 高
    描述: "移除多余控件，按日程事件跨度限制可选年月。"
    交付物:
      - "移除 monthTrigger 右侧展开箭头"
      - "移除 month-panel-title、month-label、取消按钮"
      - "可选年月依据当前日历事件跨度动态生成"
    备注: "已移除 monthTrigger 右侧箭头、面板标题/字段标签/取消按钮，并接入事件跨度计算（最小月至最大月）来动态生成可选年月。"

  - 编号: M35
    标记: 回归验收
    标题: 构建与年月选择行为验证
    状态: 已完成
    优先级: 高
    描述: "执行构建并验证新年月面板精简与跨度限制行为。"
    交付物:
      - "gradlew build 通过"
      - "面板控件精简符合预期"
      - "年份/月份选项按事件跨度限制"
    备注: "已通过 `gradlew build`；Chrome MCP 验证月触发按钮无箭头、面板仅保留年份/月份与确定按钮，且选项范围按事件跨度限制（示例：2025-11 至 2026-02）。"

  - 编号: M36
    标记: 后端优化
    标题: 静态范围存储与后台触发重算
    状态: 已完成
    优先级: 高
    描述: "将日历年月范围持久化到日历状态，并在后台事件增改删后触发后端重算。"
    交付物:
      - "日历状态新增最小/最大月份字段"
      - "后端提供重算接口并落盘"
      - "后台事件增改删后自动调用重算"
      - "前台组件改为读取静态范围"
    备注: "已在日历 status 新增 `rangeStartMonth/rangeEndMonth`，新增后端 `refresh-stats` 接口并重算落盘（含 eventCount）；后台事件增改删后自动调用该接口；前台组件改为读取日历静态范围，不再全量扫描事件计算月份跨度。"

  - 编号: M37
    标记: 回归验收
    标题: 构建与静态范围行为验证
    状态: 已完成
    优先级: 高
    描述: "执行构建并验证范围重算与前台读取行为。"
    交付物:
      - "gradlew build 通过"
      - "前台不再全量扫描事件计算范围"
      - "后台增改删后范围可更新"
    备注: "已通过 `gradlew build`；代码回归确认前台已移除 `fetchRangeEvents/buildMonthRange`，改为读取 `calendar.status.rangeStartMonth/rangeEndMonth`；后台事件页面在创建/更新/删除后会调用 `POST /apis/api.schedule.bi1kbu.com/v1alpha1/schedulecalendars/{name}/refresh-stats` 触发重算。"

  - 编号: M38
    标记: 开发环境排障
    标题: haloServer createHaloContainer 失败定位与修复
    状态: 已完成
    优先级: 高
    描述: "定位 `gradlew haloServer` 在 `createHaloContainer` 阶段失败的具体原因并修复。"
    交付物:
      - "失败根因定位明确"
      - "本地容器状态修复完成"
      - "可继续启动 haloServer"
    备注: "根因已定位为 Docker 409 冲突：容器名 `halo-for-plugin-development` 已被占用；执行 `gradlew removeHaloContainer` 清理后可恢复启动流程。"

  - 编号: M39
    标记: 回归验收
    标题: haloServer 启动验证
    状态: 已完成
    优先级: 高
    描述: "验证 `gradlew haloServer` 可执行并进入运行态。"
    交付物:
      - "createHaloContainer 通过"
      - "haloServer 启动流程通过"
      - "计划状态回写完成"
    备注: "容器已成功创建并运行（`docker ps` 显示 `halo-for-plugin-development` Up，映射 `8090->8090`）；日志确认 `plugin-schedule` 已启动。重复执行 `createHaloContainer/haloServer` 前需先 `gradlew removeHaloContainer`。"

  - 编号: M40
    标记: 管理端优化
    标题: 事件日期精度与页面分区重排
    状态: 已完成
    优先级: 高
    描述: "将事件时间输入改为按天精度，并优化后台页面排版与功能分区。"
    交付物:
      - "事件开始/结束输入改为日期级别"
      - "事件页面样式重排（列表、基础信息、关联文章、高亮规则）"
      - "日历配置页面样式统一优化"
    备注: "已将事件开始/结束输入改为按天（type=date），保存时转换为 ISO 日期边界；并重排后台页面分区与排版（功能导航、事件列表、基础信息、关联文章、高亮规则），日历配置页同步优化并展示事件范围。"

  - 编号: M41
    标记: 回归验收
    标题: 构建与后台交互验证
    状态: 已完成
    优先级: 高
    描述: "执行构建并验证按天输入与后台样式优化结果。"
    交付物:
      - "gradlew build 通过"
      - "事件表单按天输入可用"
      - "后台排版分区清晰"
    备注: "已通过 `gradlew build`；Chrome MCP 验证日程事件表单为按天输入（开始/结束日期），事件列表展示为日期列；日历配置与事件页面已按功能分区重排，导航与切换区样式统一。"

  - 编号: M42
    标记: 管理端交互重构
    标题: 移除布局功能导航并拆分日程事件子导航
    状态: 已完成
    优先级: 高
    描述: "移除布局卡片内功能导航，在日程事件页内部新增子导航（日程清单/新建日程），并增加仅本次会话可见的新建日程临时列表。"
    交付物:
      - "布局页移除功能导航区块"
      - "日程事件页拆分为日程清单与新建日程两个子导航"
      - "新增临时日程列表（刷新页面后清空）"
    备注: "已移除布局卡片内“功能导航”区块；日程事件页新增“日程清单/新建日程”子导航，并在新建页追加会话级临时新建列表（刷新页面后清空）。"

  - 编号: M43
    标记: 回归验收
    标题: 构建与页面行为验证
    状态: 已完成
    优先级: 高
    描述: "执行构建并验证新子导航、临时新建列表与布局调整。"
    交付物:
      - "gradlew build 通过"
      - "日程清单/新建日程切换可用"
      - "临时新建列表仅会话内保留"
    备注: "已通过 `gradlew build`；代码与界面结构验证子导航切换逻辑和临时列表会话态实现。Chrome MCP 本轮受本地浏览器 profile 占用限制，未完成交互录制式验证。"

  - 编号: M44
    标记: 管理端与组件联动优化
    标题: 子导航重排、事件规则调整与日历配置精简
    状态: 已完成
    优先级: 高
    描述: "完成事件页子导航与筛选增强、日历配置页面精简，并将前台标题显示开关迁移到小组件级配置。"
    交付物:
      - "布局页移除 card-body 区域，日历选择迁移到事件子导航右侧下拉"
      - "事件页去除多余标签/按钮，新增标题/高亮/时间范围筛选"
      - "事件标题改为选填，关联文章改为必填，空标题自动回落文章标题"
      - "日历配置移除主题色、公开展示、前台标题显示开关"
      - "小组件新增前台标题显示开关并驱动前台组件渲染"
    备注: "已完成：布局页移除 card-body；事件页子导航右侧新增日历下拉并移除多余标签/按钮；新增清单筛选（标题/突出显示/时间范围）；标题改为选填且空值回落关联文章标题；关联文章改为必填；日历配置页移除主题色/公开展示/前台标题开关；前台标题显示改由小组件 show-title 属性控制。"

  - 编号: M45
    标记: 回归验收
    标题: 构建与界面行为复测
    状态: 已完成
    优先级: 高
    描述: "执行构建并复测日程事件新交互、日历配置精简和小组件标题开关生效。"
    交付物:
      - "gradlew build 通过"
      - "事件页筛选与联动行为符合预期"
      - "小组件 show-title 配置生效"
    备注: "已通过 `gradlew build`（含 UI type-check 与构建）；关键代码回归确认：事件页筛选和标题回落逻辑生效，编辑器新增 showTitle 开关并向前台输出 `show-title`，前台组件按该属性控制标题显示。Chrome MCP 本轮受 profile 占用限制，未完成页面录制式验证。"

  - 编号: M46
    标记: 调试环境
    标题: 释放并重连 Chrome MCP 会话
    状态: 已完成
    优先级: 高
    描述: "强制释放占用的 Chrome profile 锁，恢复 Chrome MCP 可连接状态。"
    交付物:
      - "占用进程已清理"
      - "MCP 可创建/列出页面"
    备注: "已恢复：Chrome MCP `list_pages` 可正常返回页面列表，锁占用问题解除，可继续执行页面级自动化验证。"

  - 编号: M47
    标记: 回归验收
    标题: Chrome MCP 页面行为验证
    状态: 已完成
    优先级: 高
    描述: "使用 Chrome MCP 复测本轮管理端调整：子导航、日历下拉、筛选、配置精简和小组件显示开关。"
    交付物:
      - "关键页面可访问"
      - "主要交互验证完成"
      - "验证结果回写备注"
    备注: "已完成 MCP 验证：`/console/schedule/events` 子导航右侧下拉生效，`calendar-tip` 与临时列表清空按钮已移除，列表筛选（标题/突出显示）可用；创建事件时不填标题+选择文章后成功落库并标题回落为文章标题；`/console/schedule/calendars` 仅保留日历名称配置且头部 actions 在右侧；前台通过脚本挂载 `schedule-view` 验证 `show-title=true` 显示标题、`show-title=false` 隐藏标题。"

  - 编号: M48
    标记: 管理端细节优化
    标题: 菜单文案与日程表单布局精简
    状态: 已完成
    优先级: 高
    描述: "将日程事件菜单改为日程管理，精简日程清单头部操作区并调整新建日程字段与卡片顺序。"
    交付物:
      - "菜单文案由日程事件改为日程管理"
      - "日程清单移除 header-actions"
      - "新建日程移除所属日历和状态字段，默认使用右上角当前日历"
      - "关联文章卡片移动到基础信息卡片上方"
      - "card-title 显示间距和对齐优化"
    备注: "已完成：菜单文案改为“日程管理”；日程清单移除 header-actions；新建日程移除所属日历和状态字段并复用右上角当前日历；关联文章卡片已移到基础信息上方；card-title 已增加边距与对齐优化。"

  - 编号: M49
    标记: 回归验收
    标题: 构建与页面回归验证
    状态: 已完成
    优先级: 高
    描述: "执行构建并验证菜单改名、字段移除与布局调整效果。"
    交付物:
      - "gradlew build 通过"
      - "事件页布局与字段行为符合预期"
      - "计划状态落盘完成"
    备注: "已通过 `gradlew build`；Chrome MCP 验证 `日程事件` 菜单已显示为 `日程管理`，新建页字段和卡片顺序符合预期，清单页头部已无 actions 按钮，页面显示与交互正常。"

  - 编号: M50
    标记: 缺陷修复
    标题: 编辑日程保存 500 错误修复
    状态: 已完成
    优先级: 高
    描述: "修复编辑日程保存时报服务器内部错误的问题。"
    交付物:
      - "更新请求携带 metadata.version"
      - "编辑保存成功且无 500"
      - "问题根因记录到备注"
    备注: "已修复：编辑时记录 `metadata.version` 并在更新请求里回传（`metadata.name + metadata.version`），避免后端走插入路径导致主键冲突。"

  - 编号: M51
    标记: 回归验收
    标题: 构建与编辑保存回归验证
    状态: 已完成
    优先级: 高
    描述: "执行构建并通过 MCP 验证编辑保存流程恢复正常。"
    交付物:
      - "gradlew build 通过"
      - "编辑保存请求返回 2xx"
      - "无服务器内部错误提示"
    备注: "已通过 `gradlew build`；Chrome MCP 复测编辑保存：`PUT /scheduleevents/{name}` 从 500 恢复为 200，随后 `refresh-stats` 与事件列表刷新均成功，无“服务器内部错误”。"

  - 编号: M52
    标记: 缺陷修复
    标题: 关联文章置顶快照识别与前台高亮修复
    状态: 已完成
    优先级: 高
    描述: "修复后台置顶快照显示否/未知与前台未高亮的问题。"
    交付物:
      - "明确置顶字段来源并补齐识别逻辑"
      - "事件保存时置顶快照正确落盘"
      - "前台高亮跟随置顶快照生效"
    备注: "已完成：事件页新增“关联文章快照强制同步”流程（选中文章、编辑加载、保存前均拉取 `GET /posts/{name}`），修复置顶快照长期停留“否/未知”的问题；更新保存请求可正确写入 `relatedPostPinnedSnapshot=true`，前台高亮按快照生效。"

  - 编号: M53
    标记: 回归验收
    标题: 构建与置顶高亮行为验证
    状态: 已完成
    优先级: 高
    描述: "执行构建并验证后台快照与前台高亮行为。"
    交付物:
      - "gradlew build 通过"
      - "后台置顶快照显示正确"
      - "前台高亮显示正确"
    备注: "已通过 `gradlew build` 与 `gradlew reloadPlugin`；Chrome MCP 验证：编辑旧事件时会请求 `GET /apis/content.halo.run/v1alpha1/posts/{name}` 并将置顶快照显示为“是”；保存请求 `PUT /scheduleevents/{name}` 请求体含 `relatedPostPinnedSnapshot:true` 且返回 200；前台页面刷新后对应日程卡片 `item.highlight=true`。"

  - 编号: M54
    标记: 前台交互增强
    标题: Upcoming 日程点击跳转文章
    状态: 已完成
    优先级: 高
    描述: "支持在前台点击 Upcoming 日程卡片跳转到关联文章页面。"
    交付物:
      - "事件数据携带文章链接快照"
      - "Upcoming 卡片可点击跳转"
      - "无关联文章时保持不可点击"
    备注: "已完成：事件模型与后台保存增加 `relatedPostPermalinkSnapshot`；前台 Upcoming 卡片在有链接快照时渲染为可点击链接，并增加旧数据 permalink 自动补全兜底。"

  - 编号: M55
    标记: 日历渲染增强
    标题: 跨天日程范围内逐天显示
    状态: 已完成
    优先级: 高
    描述: "后台配置跨天日程后，日历中范围内每一天都应显示该日程占位。"
    交付物:
      - "后端范围过滤按时间重叠判断"
      - "前台按 startAt~endAt 展开到每日"
      - "点击范围内任一天可看到该日程"
    备注: "已完成：后端 `inTimeRange` 改为按事件区间与查询区间重叠判断（`endAt` 为空时按 `startAt`）；前台日历按事件 `startAt~endAt` 逐天展开打点，跨天范围内每天都会显示。"

  - 编号: M56
    标记: 回归验收
    标题: 构建与前后台行为验证
    状态: 已完成
    优先级: 高
    描述: "执行构建并验证 Upcoming 跳转与跨天显示行为。"
    交付物:
      - "gradlew build 通过"
      - "Upcoming 点击可跳转文章"
      - "跨天日程在范围内连续显示"
    备注: "已通过 `gradlew build reloadPlugin`；Chrome MCP 验证：Upcoming 中存在文章链接卡片（如 `/archives/hello-halo`）并点击后页面跳转到文章；跨天事件 `2026-06-01~2026-06-02` 在 6/1 与 6/2 天格均有事件标记，点击 6/2 请求按天范围时仍返回该事件（后端重叠过滤生效）。"

  - 编号: M57
    标记: 视觉优化
    标题: 后台 header-row 边距调整
    状态: 已完成
    优先级: 中
    描述: "为各模块卡片头部的 header-row 增加上/左边距，优化贴边显示问题。"
    交付物:
      - "日历配置页 header-row 增加边距"
      - "日程管理页 header-row 增加边距"
      - "标题与操作区域对齐保持正常"
    备注: "已完成：`ScheduleCalendarsView` 与 `ScheduleEventsView` 的 `.header-row` 增加统一内边距（上/左方向明显增距），头部标题与操作按钮对齐保持正常。"

  - 编号: M58
    标记: 回归验收
    标题: 样式构建与页面检查
    状态: 已完成
    优先级: 中
    描述: "执行前端构建并检查 header-row 边距视觉效果。"
    交付物:
      - "前端构建通过"
      - "header-row 上/左边距生效"
      - "无布局错位回归"
    备注: "已通过 `./gradlew.bat :ui:pnpmBuild` 与 `./gradlew.bat reloadPlugin`；Chrome MCP 在 `日程管理` 与 `日历配置` 页面实测 `.header-row` 计算样式为 `padding: 6px 4px 2px 8px`，上/左边距已生效且标题/按钮对齐正常。"

  - 编号: M59
    标记: 结构统一
    标题: 日历配置新建卡片标题包裹 header-row
    状态: 已完成
    优先级: 中
    描述: "为 日程→日历配置→新建日历 卡片标题补齐 header-row 包裹，统一头部结构与外边距。"
    交付物:
      - "新建日历卡片 header 使用 header-row"
      - "card-title 保持现有文案与逻辑"
      - "样式结构与其他卡片一致"
    备注: "已完成：`ScheduleCalendarsView` 第二张卡片（新建/编辑日历）header 已改为 `header-row` 包裹 `card-title`，与同页其他卡片头部结构保持一致。"

  - 编号: M60
    标记: 回归验收
    标题: 模板与构建验证
    状态: 已完成
    优先级: 中
    描述: "执行前端构建并确认 header-row 包裹结构生效且无回归。"
    交付物:
      - "前端构建通过"
      - "header-row 结构可见"
      - "页面无报错"
    备注: "已通过 `./gradlew.bat :ui:pnpmBuild`；代码检查确认 `新建/编辑日历` 卡片 header 已使用 `header-row` 包裹 `card-title`，模板编译正常且无页面报错。"

  - 编号: M61
    标记: 前台范围优化
    标题: Upcoming 结束日期改为最晚日程日期
    状态: 已完成
    优先级: 高
    描述: "将前台固定范围文案与查询结束时间从“今天+1年”改为“当前日历最晚日程日期”（有兜底）。"
    交付物:
      - "日历状态提供最晚日程日期字段"
      - "前台读取静态最晚日期生成 Upcoming 范围"
      - "缺省场景回落到现有默认策略"
    备注: "已完成：后端状态新增 `rangeEndDate` 并在 refresh-stats 时按事件实际结束日期回写；前台 `schedule.umd.js` 已改为优先读取该静态字段生成 Upcoming 查询结束时间与“固定范围”结束日期，缺省时回落今天+1年。"

  - 编号: M62
    标记: 回归验收
    标题: 构建与范围文案验证
    状态: 已完成
    优先级: 高
    描述: "执行构建并验证固定范围结束日期按最晚日程日期展示。"
    交付物:
      - "gradlew build 通过"
      - "固定范围结束日期非硬编码+1年"
      - "无最晚日期时兜底行为正常"
    备注: "已完成：`./gradlew.bat build` 通过；代码验证确认 Upcoming 结束日期优先取 `calendar.status.rangeEndDate`，并用于查询参数 `to` 与固定范围文案；当该字段缺失或异常时回退到“今天+1年”。"

  - 编号: M63
    标记: 环境同步
    标题: 运行实例热更新与状态重算
    状态: 已完成
    优先级: 高
    描述: "处理“代码已改但页面无变化”的运行态同步问题，确保插件热更新并重算日历状态。"
    交付物:
      - "reloadPlugin 执行成功"
      - "refresh-stats 执行成功"
      - "日历状态返回 rangeEndDate"
    备注: "已完成：执行 `./gradlew.bat reloadPlugin` 成功；随后调用 `POST /apis/api.schedule.bi1kbu.com/v1alpha1/schedulecalendars/{name}/refresh-stats` 返回 200；再次查询日历列表确认 `status.rangeEndDate` 已出现（示例值 `2026-06-02`）。"

  - 编号: M64
    标记: 回归验收
    标题: 运行态数据可见性验证
    状态: 已完成
    优先级: 中
    描述: "验证运行中的公开接口已返回最新状态字段，确认前台可读取。"
    交付物:
      - "公开接口返回包含 rangeEndDate"
      - "版本号递增确认状态已写回"
      - "问题原因与操作步骤沉淀"
    备注: "已完成：`GET /apis/api.schedule.bi1kbu.com/v1alpha1/schedulecalendars` 返回 `status.rangeEndDate`，并观察到 `metadata.version` 从 11 到 12，确认重算落盘已生效。"

  - 编号: M65
    标记: 文档
    标题: README 项目介绍与适配说明重写
    状态: 已完成
    优先级: 中
    描述: "重写 README，补齐插件能力、架构、开发运行、配置说明，并提供明暗主题色适配说明。"
    交付物:
      - "README 中文重写"
      - "项目介绍与使用说明完整"
      - "明暗主题色适配章节"
    备注: "已完成：重写 `README.md`，补齐项目简介、架构、开发运行、使用方式、统计字段说明，并新增明暗主题色适配章节（含 Shadow DOM 限制说明与 `prefers-color-scheme` 示例）。"

  - 编号: M66
    标记: 回归验收
    标题: 文档完整性校验
    状态: 已完成
    优先级: 中
    描述: "校验 README 结构完整性与关键信息覆盖，确保可用于交付和后续维护。"
    交付物:
      - "章节结构清晰"
      - "关键命令可执行"
      - "主题适配示例可落地"
    备注: "已完成：校验通过（`README_CHECK:PASS`），已覆盖项目介绍、运行命令、使用说明与明暗主题适配策略；包含 `prefers-color-scheme: dark` 示例与 Shadow DOM 适配约束说明。"

  - 编号: M67
    标记: 前台样式
    标题: 日程组件 CSS 变量化与明暗主题切换
    状态: 已完成
    优先级: 高
    描述: "参考评论组件的变量方案，为前台 `schedule-view` 提供可覆盖的 CSS 变量，并支持深色模式自动切换默认值。"
    交付物:
      - "schedule.umd.js 样式颜色改为变量驱动"
      - "提供 light/dark 默认变量"
      - "主题可通过 CSS 变量覆盖配色"
    备注: "已完成：`schedule.umd.js` 颜色系统已变量化，新增 `--halo-sw-*` 主题变量；组件内置 light/dark 默认值并通过 `prefers-color-scheme: dark` 自动切换，前台样式可在主题 CSS 中覆盖。"

  - 编号: M68
    标记: 回归验收
    标题: 明暗主题适配文档与构建验证
    状态: 已完成
    优先级: 高
    描述: "补充 README 的变量清单与示例，并执行构建验证。"
    交付物:
      - "README 增加变量清单和主题切换示例"
      - "gradlew build 通过"
      - "计划状态回写完成"
    备注: "已完成：README 主题章节改为可落地方案，新增变量清单与 `.color-scheme-light/.color-scheme-dark/:root[data-color-scheme]` 覆盖示例；`./gradlew.bat build` 构建通过。"

  - 编号: M69
    标记: 发布元信息
    标题: License 与版本号更新
    状态: 已完成
    优先级: 高
    描述: "将项目 License 调整为 MIT，并将版本号更新为 1.0.1。"
    交付物:
      - "plugin.yaml 许可证改为 MIT"
      - "项目版本号改为 1.0.1"
      - "LICENSE 与 README 许可证信息同步"
    备注: "已完成：`plugin.yaml` 许可证改为 `MIT`，`gradle.properties` 版本更新为 `1.0.1`，并同步更新 `README.md` 许可证说明与 `LICENSE` 文本为 MIT。"

  - 编号: M70
    标记: 打包
    标题: 插件重新构建与产物确认
    状态: 已完成
    优先级: 高
    描述: "执行构建并确认 1.0.1 版本插件产物生成。"
    交付物:
      - "gradlew build 通过"
      - "build/libs 产物版本号正确"
      - "计划状态回写完成"
    备注: "已完成：执行 `./gradlew.bat clean build` 构建通过；产物已生成 `build/libs/plugin-schedule-1.0.1.jar`。"

  - 编号: M71
    标记: 前台样式修复
    标题: 暗色模式下 btn 与 cell 文字色统一
    状态: 已完成
    优先级: 高
    描述: "修复暗色模式中 `btn` 与 `cell` 文本显示为黑色的问题，统一为与 `cell.has-event` 相同的文字颜色。"
    交付物:
      - "btn 文字色显式指定"
      - "cell 文字色显式指定"
      - "暗色模式下可读性恢复"
    备注: "已完成：在 `schedule.umd.js` 中为 `.btn` 与 `.cell` 显式设置 `color: var(--sw-text-1)`，与 `.cell.has-event` 文本色一致，修复暗色模式黑字问题。"

  - 编号: M72
    标记: 回归验收
    标题: 构建与样式结果验证
    状态: 已完成
    优先级: 高
    描述: "执行构建并确认暗色模式下按钮与天格文字颜色一致。"
    交付物:
      - "gradlew build 通过"
      - "btn/cell 与 has-event 文字色一致"
      - "计划状态回写完成"
    备注: "已完成：执行 `./gradlew.bat build` 通过；代码检查确认 `.btn`/`.cell`/`.cell.has-event` 均使用 `var(--sw-text-1)` 作为文本色。"

  - 编号: M73
    标记: 运行测试
    标题: 启动开发环境并打开 MCP
    状态: 已完成
    优先级: 高
    描述: "启动 Halo 开发环境，使用 Chrome MCP 打开后台页面并完成基础可达性测试。"
    交付物:
      - "Halo 服务可访问"
      - "MCP 可打开目标页面"
      - "关键页面加载成功"
    备注: "已完成：`docker` 容器 `halo-for-plugin-development` 已启动并映射 `8090`；`http://127.0.0.1:8090` 返回 200；使用 Chrome MCP 登录后台并成功访问 `日历配置` 与 `日程管理` 页面。"

  - 编号: M74
    标记: 回归验收
    标题: MCP 测试结果回写
    状态: 已完成
    优先级: 中
    描述: "记录 MCP 页面访问与测试结论，完成本轮状态落盘。"
    交付物:
      - "测试步骤记录"
      - "结果与异常说明"
      - "计划状态回写完成"
    备注: "已完成：MCP 验证后台页面正常渲染（菜单、子菜单、表单与列表均可见），切换 `日程清单/新建日程` 正常；控制台无 `error/warn`；本地执行 `./gradlew.bat build` 成功。"

  - 编号: M75
    标记: 打包
    标题: 执行插件构建打包
    状态: 已完成
    优先级: 高
    描述: "执行构建流程，生成最新插件 Jar。"
    交付物:
      - "gradlew build 通过"
      - "build/libs 生成插件 Jar"
    备注: "已完成：`./gradlew.bat build` 执行成功并生成插件产物。`clean` 因运行中进程占用 `build` 目录失败，改用不清理构建完成打包。"

  - 编号: M76
    标记: 回归验收
    标题: 打包结果确认与状态回写
    状态: 已完成
    优先级: 中
    描述: "确认产物文件与版本信息，回写计划状态。"
    交付物:
      - "产物文件名确认"
      - "计划状态回写完成"
    备注: "已完成：产物为 `build/libs/plugin-schedule-1.0.1.jar`（LastWriteTime: 2026-02-12 22:28:50）；本轮打包状态已回写。"

  - 编号: M77
    标记: 前台交互优化
    标题: 滚轮按格触发周切换
    状态: 已完成
    优先级: 高
    描述: "将日历滚轮行为从时间节流触发改为按滚轮事件即时触发，保证滚轮一格即切换一周。"
    交付物:
      - "移除滚轮 220ms 时间锁"
      - "滚轮事件即时触发 shiftWeek"
    备注: "已完成：移除 `wheelLockedUntil` 与锁判断，`onWheel` 直接按 `deltaY` 触发 `shiftWeek(±1)`。"

  - 编号: M78
    标记: 回归验收
    标题: 构建与滚轮行为验证
    状态: 已完成
    优先级: 中
    描述: "执行构建并确认滚轮交互修改未引入回归。"
    交付物:
      - "gradlew build 通过"
      - "滚轮行为逻辑变更落地"
    备注: "已完成：执行 `./gradlew.bat build` 成功，前台滚轮逻辑已切换为每次滚轮事件即时触发。"

  - 编号: M79
    标记: 打包自动化
    标题: 打包前自动递增版本号
    状态: 已完成
    优先级: 高
    描述: "新增打包任务，在执行构建前自动将 `gradle.properties` 的版本号按补丁位 `+0.0.1`。"
    交付物:
      - "新增 `bumpPatchVersion` 任务"
      - "新增 `packagePlugin` 任务"
      - "打包顺序为先升版本后构建"
    备注: "已完成：在 `build.gradle` 中新增 `bumpPatchVersion` 与 `packagePlugin`；`build` 设置 `mustRunAfter bumpPatchVersion`，确保打包时先升版本再构建。"

  - 编号: M80
    标记: 回归验收
    标题: 自动升版打包任务验证
    状态: 已完成
    优先级: 高
    描述: "执行自动升版打包任务并确认版本号与产物一致。"
    交付物:
      - "`packagePlugin` 执行成功"
      - "`gradle.properties` 版本号已递增"
      - "`build/libs` 产物版本匹配"
    备注: "已完成：执行 `./gradlew.bat packagePlugin` 后版本从 `1.0.5` 升至 `1.0.6`，并生成 `build/libs/plugin-schedule-1.0.6.jar`。"

  - 编号: M81
    标记: 编辑器增强
    标题: 日程组件配置区对齐与预览增强
    状态: 已完成
    优先级: 高
    描述: "优化编辑器中日程组件配置区布局，修复下拉对齐问题，并在选择后提供稳定可视预览。"
    交付物:
      - "日历下拉与开关区域对齐优化"
      - "选择日历后展示预览卡片"
      - "编辑器内不依赖前台 Web Component 的预览可见性"
    备注: "已完成：`ui/src/editor/ScheduleView.vue` 改为网格对齐布局，新增本地预览壳层（标题+月历区域/近期日程占位）并在选择后立即显示。"

  - 编号: M82
    标记: 渲染样式
    标题: 新增渲染样式下拉并接入前台
    状态: 已完成
    优先级: 高
    描述: "新增 `渲染样式` 下拉，支持在组件属性中保存并传递到前台组件，便于后续扩展多样式。"
    交付物:
      - "编辑器节点属性新增 renderStyle"
      - "前台 `schedule-view` 支持 `render-style` 属性"
      - "提供默认/紧凑两种样式实现"
    备注: "已完成：`schedule-edited.ts` 新增 `renderStyle` 属性解析和输出；`schedule.umd.js` 新增 `render-style` 观察与 `default/compact` 样式分支；MCP 页面验证已出现“渲染样式”下拉。"

  - 编号: M83
    标记: 编辑器样式
    标题: schedule-view-nav 调整为两行布局
    状态: 已完成
    优先级: 高
    描述: "按交互要求将组件配置头部改为两行：第一行显示组件说明与显示标题开关，第二行显示日历/样式选择器。"
    交付物:
      - "第一行：左侧“日程组件”，右侧 show-title-switch"
      - "第二行：日历选择器 + 样式选择器"
      - "移动端下自动纵向折叠"
    备注: "已完成：`ui/src/editor/ScheduleView.vue` 重构为 `schedule-view-nav-top` 与 `schedule-view-nav-bottom` 两行结构，并同步更新响应式样式。"

  - 编号: M84
    标记: 回归验收
    标题: 两行布局构建验证
    状态: 已完成
    优先级: 中
    描述: "执行构建验证两行排版调整未引入编译回归。"
    交付物:
      - "gradlew build 通过"
      - "编辑器配置区结构更新生效"
    备注: "已完成：执行 `./gradlew.bat build` 成功，UI 构建与类型检查均通过。"

  - 编号: M85
    标记: 渲染样式收敛
    标题: 移除紧凑样式并保留默认选项
    状态: 已完成
    优先级: 高
    描述: "按当前需求移除紧凑样式，仅保留默认样式选项，前台与编辑器行为统一回落默认。"
    交付物:
      - "编辑器渲染样式下拉仅保留默认样式"
      - "节点属性 parse/render 回落默认"
      - "前台移除 compact 分支样式"
    备注: "已完成：`ScheduleView.vue` 移除紧凑选项；`schedule-edited.ts` 仅输出默认 render-style；`schedule.umd.js` 固定使用 default 并删除 wrap-compact 样式分支。"

  - 编号: M86
    标记: 回归验收
    标题: 样式收敛与页面验证
    状态: 已完成
    优先级: 中
    描述: "构建并通过 MCP 验证渲染样式下拉仅有一个默认选项。"
    交付物:
      - "gradlew build 通过"
      - "MCP 页面验证通过"
    备注: "已完成：`./gradlew.bat build` 成功；MCP 编辑页快照显示“渲染样式”下拉仅剩 `默认样式` 一个选项。"
