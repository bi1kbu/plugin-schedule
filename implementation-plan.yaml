元信息:
  项目: plugin-schedule
  版本: 1
  负责人: bi1kbu
  最后更新: 2026-02-08
  默认状态: 待开始
  状态枚举:
    - 待开始
    - 进行中
    - 阻塞
    - 已完成
  执行规则: "任一时刻只允许一个步骤处于进行中。"
  完成规则: "必须先将当前步骤标记为已完成，才能开始下一步。"

流程控制:
  工作流模式: 顺序执行
  完成步骤后必须更新状态: true
  更新状态后必须读取下一步: true
  停止条件: 全部步骤已完成
  阻塞处理策略: "若发生阻塞，状态设为阻塞，并在备注写明阻塞原因；解决后再继续。"

步骤:
  - 编号: M1
    标记: 初始化
    标题: 插件脚手架与本地运行
    状态: 已完成
    优先级: 高
    描述: "初始化插件骨架，验证 haloServer 可启动，并确认构建产物可生成。"
    交付物:
      - "项目结构创建完成"
      - "haloServer 可运行"
      - "Jar 构建通过"
    备注: "已完成脚手架初始化，`gradlew build` 通过，并验证 `haloServer` 可启动。"

  - 编号: M2
    标记: 后端
    标题: 领域模型与 API
    状态: 已完成
    优先级: 高
    描述: "实现 ScheduleCalendar 与 ScheduleEvent 扩展、索引、服务层与公开/自定义端点。"
    交付物:
      - "扩展模型与索引注册完成"
      - "增删改查与查询 API 完成"
      - "角色模板与反向代理配置完成"
    备注: "已实现 ScheduleCalendar/ScheduleEvent 扩展、索引注册、查询对象、服务层与公开端点。"

  - 编号: M3
    标记: 管理端界面
    标题: 后台管理 UI
    状态: 已完成
    优先级: 高
    描述: "实现日程组件配置页与事件管理页，支持关联文章选择。"
    交付物:
      - "组件配置列表/编辑界面"
      - "事件列表/编辑界面"
      - "关联文章流程"
    备注: "已实现后台日历配置页与事件管理页，支持事件与文章信息关联字段维护。"

  - 编号: M4
    标记: 编辑器扩展
    标题: 富文本编辑器区块集成
    状态: 已完成
    优先级: 中
    描述: "新增 schedule-view 区块节点、工具箱入口、气泡菜单与节点预览。"
    交付物:
      - "可插入的编辑器区块"
      - "区块属性可编辑"
      - "编辑器内预览可用"
    备注: "已实现富文本 `schedule-view` 区块，包含命令菜单、工具箱与节点属性编辑。"

  - 编号: M5
    标记: 前台组件
    标题: 日程展示组件
    状态: 已完成
    优先级: 高
    描述: "使用 Lit 开发前台组件，完成月历与 upcoming 面板展示并适配主题。"
    交付物:
      - "schedule.umd.js"
      - "月历 + upcoming 渲染"
      - "响应式布局支持"
    备注: "已提供前台 `schedule.umd.js` 组件，支持月历展示、日期筛选与 upcoming 列表。"

  - 编号: M6
    标记: 测试与发布
    标题: 质量验证、打包与发布验收
    状态: 已完成
    优先级: 高
    描述: "验证权限、时区、跨月边界，完成打包并在 Halo 中安装验收。"
    交付物:
      - "测试清单执行完成"
      - "构建产物验证完成"
      - "安装与冒烟测试完成"
    备注: "已完成构建与测试验收；处理容器名冲突后成功启动 Halo 开发容器进行冒烟验证。"

  - 编号: M7
    标记: 菜单重构
    标题: 日程父菜单与子菜单结构调整
    状态: 已完成
    优先级: 高
    描述: "将现有平级菜单重构为 `日程` 一级菜单，并挂载 `日历配置`、`日程事件` 两个子菜单。"
    交付物:
      - "日程父路由与布局页"
      - "两个子菜单可见且可切换"
      - "父级页面显示日历切换控件"
    备注: "已改为父路由 `日程` + 子菜单 `日历配置/日程事件`，并新增布局页显示日历切换控件。"

  - 编号: M8
    标记: 表单重构
    标题: 编辑操作改为页面控件
    状态: 已完成
    优先级: 高
    描述: "去除 prompt 交互，改为页面内表单进行新建、编辑和关联操作。"
    交付物:
      - "日历配置页面内表单"
      - "日程事件页面内表单"
      - "关联文章手动选择控件"
    备注: "已将日历和事件编辑改为页面内表单控件，移除 prompt 交互并支持手动文章选择。"

  - 编号: M9
    标记: 事件规则
    标题: 事件字段与突出显示规则
    状态: 已完成
    优先级: 高
    描述: "支持开始时间必填、结束时间选填、互斥突出显示开关，未指定时跟随关联文章置顶属性。"
    交付物:
      - "后端字段扩展"
      - "前端表单校验与互斥逻辑"
      - "前台组件突出显示渲染"
    备注: "已实现开始时间必填、结束时间选填、互斥突出显示开关，并在前台组件应用文章置顶兜底规则。"

  - 编号: M10
    标记: 验证
    标题: 构建与功能回归验证
    状态: 已完成
    优先级: 高
    描述: "执行构建与基础运行验证，确认菜单、表单与事件规则可用。"
    交付物:
      - "gradlew build 通过"
      - "关键页面可访问"
      - "计划状态回写完成"
    备注: "已完成构建验证并通过 Chrome MCP 冒烟测试：菜单层级、页面表单、互斥突出显示逻辑均生效。"

  - 编号: M11
    标记: 编辑器样式
    标题: 小组件入口样式统一
    状态: 已完成
    优先级: 高
    描述: "将编辑器工具箱中的 `插入日程` 入口改为与系统组件一致的样式。"
    交付物:
      - "使用统一 ToolboxItem 风格"
      - "入口图标与标题统一"
    备注: "已改用富文本编辑器 `ToolboxItem`，入口样式和系统组件保持一致。"

  - 编号: M12
    标记: 编辑器交互
    标题: 日历选择方式优化
    状态: 已完成
    优先级: 高
    描述: "将小组件中的手动输入日历名称改为下拉选择，并保持编辑器预览区一致性。"
    交付物:
      - "下拉选择日历"
      - "移除手输日历名"
      - "预览提示与状态优化"
    备注: "已将节点配置改为下拉选择日历，并移除手动输入日历名称的交互路径。"

  - 编号: M13
    标记: 编辑器可用性
    标题: 删除按钮修复与回归
    状态: 已完成
    优先级: 高
    描述: "修复小组件删除按钮无效问题，完成编译和页面冒烟验证。"
    交付物:
      - "删除按钮可用"
      - "gradlew build 通过"
      - "编辑器内操作验证通过"
    备注: "已修复删除按钮无效问题并完成构建与编辑器实测：插入入口样式统一、日历下拉选择可用、删除生效。"

  - 编号: M14
    标记: 配置精简
    标题: 日历名称与默认视图字段调整
    状态: 已完成
    优先级: 高
    描述: "前台标题改为后台日历名称，移除默认视图配置能力与相关界面项。"
    交付物:
      - "前台标题使用日历 displayName"
      - "默认视图字段从配置页移除"
      - "后端日历模型移除 defaultView"
    备注: "已移除 defaultView 配置项（后端模型+管理页），前台标题改为后台日历 displayName。"

  - 编号: M15
    标记: 前台交互
    标题: 日历滚动与快速跳转
    状态: 已完成
    优先级: 高
    描述: "支持上一月/下一月之外的日期快速跳转，并支持日历区域上下滚动切月。"
    交付物:
      - "日期选择快速跳转"
      - "日历区域滚轮切月"
      - "切月后渲染一致"
    备注: "已实现日期快速跳转（日期选择器+跳转按钮+今天）及日历区域滚轮上下切月。"

  - 编号: M16
    标记: 前台样式
    标题: 日历与右侧列表颜色标记优化
    状态: 已完成
    优先级: 高
    描述: "有日程日期显示底色，高亮/置顶日程使用单独高亮色，右侧日程卡片颜色保持一致。"
    交付物:
      - "日历天方块底色标记"
      - "高亮日程专色标记"
      - "右侧卡片对应色渲染"
    备注: "已实现天格底色区分：普通日程与高亮日程分别使用不同颜色，右侧列表颜色同步。"

  - 编号: M17
    标记: 回归验证
    标题: 构建与组件功能回归
    状态: 已完成
    优先级: 高
    描述: "执行构建并用 Chrome MCP 回归验证日程组件新行为。"
    交付物:
      - "gradlew build 通过"
      - "组件标题与交互验证通过"
      - "计划状态回写完成"
    备注: "已通过 gradlew build，并用 Chrome MCP 回归：标题取日历名、颜色规则、快速跳转、滚轮切月均可用。"

  - 编号: M18
    标记: 前台交互修正
    标题: Upcoming 固定与按周滚动
    状态: 已完成
    优先级: 高
    描述: "未选中具体日期时，Upcoming 列表不随日历滚动变化；滚轮滚动改为按周平移。"
    交付物:
      - "Upcoming 与滚动日历解耦"
      - "滚轮一次移动一周"
      - "多月连续视图效果"
    备注: "已改为连续 6 周视图与滚轮按周平移；未选中日期时 Upcoming 使用固定时间范围数据，不再随滚动变化。"

  - 编号: M19
    标记: 前台验证
    标题: 跳转与列表行为回归
    状态: 已完成
    优先级: 高
    描述: "验证快速跳转、按周滚动、未选中日期时 Upcoming 固定展示。"
    交付物:
      - "Chrome MCP 行为验证"
      - "主要交互录像式复现记录（备注）"
      - "无明显回归"
    备注: "Chrome MCP 验证结果：无选中日期时滚轮前后首日由 2026-02-09 -> 2026-02-16（按周平移），Upcoming 固定范围与列表不变；跳转到 2026-03-09 生效；点击 2026-02-12 后右侧切为按日筛选。"

  - 编号: M20
    标记: 构建验收
    标题: 编译与发布前检查
    状态: 已完成
    优先级: 高
    描述: "执行构建并完成计划状态落盘。"
    交付物:
      - "gradlew build 通过"
      - "计划步骤状态完整"
      - "变更说明输出"
    备注: "已执行 `gradlew build` 并通过；计划步骤 M1-M20 状态已全部落盘，当前可进入后续细节迭代。"

  - 编号: M21
    标记: 前台交互修正
    标题: 滚动与列表刷新解耦
    状态: 已完成
    优先级: 高
    描述: "鼠标滚轮仅移动日历窗口，不触发 Upcoming/右侧列表刷新。"
    交付物:
      - "滚轮不触发右侧加载态"
      - "滚轮不改动右侧当前列表内容"
      - "左侧日历按周滚动保持可用"
    备注: "已将右侧面板刷新状态与日历滚动解耦：滚轮按周滚动仅更新左侧日历，不再触发右侧加载态与列表变更。"

  - 编号: M22
    标记: 前台交互修正
    标题: 点击与跳转触发刷新
    状态: 已完成
    优先级: 高
    描述: "仅在点击某天或跳转到某天时刷新右侧列表。"
    交付物:
      - "点击日期刷新右侧列表"
      - "跳转日期刷新右侧列表"
      - "列表副标题与筛选状态正确"
    备注: "已新增按天刷新逻辑：点击日历天格会刷新右侧为该日事件；跳转日期会定位日历并刷新右侧为跳转日事件。"

  - 编号: M23
    标记: 回归验收
    标题: 构建与行为验证
    状态: 已完成
    优先级: 高
    描述: "执行构建并通过 Chrome MCP 回归验证新交互规则。"
    交付物:
      - "gradlew build 通过"
      - "滚动不刷新列表验证通过"
      - "点击/跳转刷新列表验证通过"
    备注: "已通过 `gradlew build`；Chrome MCP 验证：滚轮后首日变化但右侧副标题/列表不变且无加载态，跳转 `2026-02-10` 与点击 `2026-02-12` 均会刷新右侧列表。"

  - 编号: M24
    标记: 前台样式修正
    标题: 跨月天格统一亮色与月份文案简化
    状态: 已完成
    优先级: 高
    描述: "跨月天格不再灰显，顶部仅显示当前月份，不显示区间月份。"
    交付物:
      - "跨月天格取消灰色样式"
      - "顶部月份改为当前月格式"
      - "滚动与点击交互保持不变"
    备注: "已移除跨月天格灰显逻辑并统一天格基础样式；顶部月份改为仅显示当前月（YYYY-MM）。"

  - 编号: M25
    标记: 回归验收
    标题: 构建与页面验证
    状态: 已完成
    优先级: 高
    描述: "执行构建并验证视觉与文案调整效果。"
    交付物:
      - "gradlew build 通过"
      - "跨月天格视觉验证通过"
      - "顶部月份文案验证通过"
    备注: "已通过 `gradlew build`；Chrome MCP 验证顶部月份为 `2026-02` 且不含区间分隔，跨月天格（如 2026-03-01）与当月天格背景/文字颜色一致。"

  - 编号: M26
    标记: 前台交互增强
    标题: 月份选择与 Upcoming 重置入口
    状态: 已完成
    优先级: 高
    描述: "移除上方日期输入框，改为点击中间月份弹出年月选择；点击 Upcoming 标题恢复全量即将发生日程。"
    交付物:
      - "移除日期输入框与跳转按钮"
      - "中间月份点击弹出年月选择"
      - "点击 Upcoming 可清空日期筛选并恢复全量列表"
    备注: "已移除日期输入框与跳转按钮；改为点击中间月份触发年月选择（type=month）；新增点击 Upcoming 标题恢复全量即将发生日程。"

  - 编号: M27
    标记: 回归验收
    标题: 构建与交互验证
    状态: 已完成
    优先级: 高
    描述: "执行构建并验证月份选择与 Upcoming 重置行为。"
    交付物:
      - "gradlew build 通过"
      - "月份选择交互验证通过"
      - "Upcoming 重置行为验证通过"
    备注: "已通过 `gradlew build`；Chrome MCP 验证旧日期输入/跳转按钮已移除，月份改为点击中部按钮+年月选择，点击 Upcoming 可将 `当前筛选` 恢复为固定范围并显示全量即将发生日程。"

  - 编号: M28
    标记: 前台展示精简
    标题: 日程卡片移除时间信息
    状态: 已完成
    优先级: 高
    描述: "右侧日程卡片仅保留日期与标题，移除时间行。"
    交付物:
      - "卡片模板移除时间行"
      - "样式清理无用时间样式"
      - "卡片显示只含日期与标题"
    备注: "已精简卡片模板，仅保留日期与标题；时间行与附加信息行已移除。"

  - 编号: M29
    标记: 回归验收
    标题: 构建与页面验证
    状态: 已完成
    优先级: 高
    描述: "执行构建并验证卡片字段精简效果。"
    交付物:
      - "gradlew build 通过"
      - "卡片时间信息已移除"
      - "日期与标题显示正常"
    备注: "已通过 `gradlew build`；Chrome MCP 验证卡片仅包含 `date` 与 `name`，`.time`/`.post` 元素均不存在。"

  - 编号: M30
    标记: 配置改造
    标题: 移除 Slug 并新增标题显示开关
    状态: 已完成
    优先级: 高
    描述: "移除日历配置中的 Slug 字段，新增控制前台是否显示日历名称的开关。"
    交付物:
      - "日历配置页移除 Slug 输入与列表列"
      - "日历模型新增 showCalendarTitle 开关"
      - "前台组件按开关决定是否渲染标题"
    备注: "已移除 Slug（后端模型/索引、类型与配置页列/表单）；新增 `showCalendarTitle` 开关并接入前台标题渲染；同时修复日历更新请求需携带 `metadata.version` 的 500 问题。"

  - 编号: M31
    标记: 回归验收
    标题: 构建与功能验证
    状态: 已完成
    优先级: 高
    描述: "执行构建并验证 Slug 移除与标题开关生效。"
    交付物:
      - "gradlew build 通过"
      - "配置页不再出现 Slug"
      - "前台标题开关行为正确"
    备注: "已通过 `gradlew build`；Chrome MCP 验证后台无 Slug 且存在“前台显示日历名称”开关；关闭开关后前台标题隐藏，重新开启后标题恢复显示。"

  - 编号: M32
    标记: 前台样式优化
    标题: monthTrigger 月份选择器样式统一
    状态: 已完成
    优先级: 高
    描述: "将 monthTrigger 触发的月份选择改为与组件风格一致的自定义选择面板。"
    交付物:
      - "移除原生 month 输入交互样式依赖"
      - "新增统一风格的年月选择弹层"
      - "保持月份切换能力可用"
    备注: "已将 monthTrigger 改为统一风格按钮，月份选择改为自定义弹层（标题、年份/月份标签、统一按钮和焦点态），与组件卡片视觉风格一致。"

  - 编号: M33
    标记: 回归验收
    标题: 构建与样式验证
    状态: 已完成
    优先级: 高
    描述: "执行构建并验证新月份选择器样式与交互行为。"
    交付物:
      - "gradlew build 通过"
      - "月份选择器样式与组件一致"
      - "选择月份后视图切换正常"
    备注: "已通过 `gradlew build`；Chrome MCP 在本地预览页验证 monthTrigger 可打开/关闭自定义年月面板，样式与卡片体系一致，选择 2027-05 后触发器文案可正确切换。"

  - 编号: M34
    标记: 前台交互优化
    标题: 年月面板简化与跨度约束
    状态: 已完成
    优先级: 高
    描述: "移除多余控件，按日程事件跨度限制可选年月。"
    交付物:
      - "移除 monthTrigger 右侧展开箭头"
      - "移除 month-panel-title、month-label、取消按钮"
      - "可选年月依据当前日历事件跨度动态生成"
    备注: "已移除 monthTrigger 右侧箭头、面板标题/字段标签/取消按钮，并接入事件跨度计算（最小月至最大月）来动态生成可选年月。"

  - 编号: M35
    标记: 回归验收
    标题: 构建与年月选择行为验证
    状态: 已完成
    优先级: 高
    描述: "执行构建并验证新年月面板精简与跨度限制行为。"
    交付物:
      - "gradlew build 通过"
      - "面板控件精简符合预期"
      - "年份/月份选项按事件跨度限制"
    备注: "已通过 `gradlew build`；Chrome MCP 验证月触发按钮无箭头、面板仅保留年份/月份与确定按钮，且选项范围按事件跨度限制（示例：2025-11 至 2026-02）。"

  - 编号: M36
    标记: 后端优化
    标题: 静态范围存储与后台触发重算
    状态: 已完成
    优先级: 高
    描述: "将日历年月范围持久化到日历状态，并在后台事件增改删后触发后端重算。"
    交付物:
      - "日历状态新增最小/最大月份字段"
      - "后端提供重算接口并落盘"
      - "后台事件增改删后自动调用重算"
      - "前台组件改为读取静态范围"
    备注: "已在日历 status 新增 `rangeStartMonth/rangeEndMonth`，新增后端 `refresh-stats` 接口并重算落盘（含 eventCount）；后台事件增改删后自动调用该接口；前台组件改为读取日历静态范围，不再全量扫描事件计算月份跨度。"

  - 编号: M37
    标记: 回归验收
    标题: 构建与静态范围行为验证
    状态: 已完成
    优先级: 高
    描述: "执行构建并验证范围重算与前台读取行为。"
    交付物:
      - "gradlew build 通过"
      - "前台不再全量扫描事件计算范围"
      - "后台增改删后范围可更新"
    备注: "已通过 `gradlew build`；代码回归确认前台已移除 `fetchRangeEvents/buildMonthRange`，改为读取 `calendar.status.rangeStartMonth/rangeEndMonth`；后台事件页面在创建/更新/删除后会调用 `POST /apis/api.schedule.bi1kbu.com/v1alpha1/schedulecalendars/{name}/refresh-stats` 触发重算。"

  - 编号: M38
    标记: 开发环境排障
    标题: haloServer createHaloContainer 失败定位与修复
    状态: 已完成
    优先级: 高
    描述: "定位 `gradlew haloServer` 在 `createHaloContainer` 阶段失败的具体原因并修复。"
    交付物:
      - "失败根因定位明确"
      - "本地容器状态修复完成"
      - "可继续启动 haloServer"
    备注: "根因已定位为 Docker 409 冲突：容器名 `halo-for-plugin-development` 已被占用；执行 `gradlew removeHaloContainer` 清理后可恢复启动流程。"

  - 编号: M39
    标记: 回归验收
    标题: haloServer 启动验证
    状态: 已完成
    优先级: 高
    描述: "验证 `gradlew haloServer` 可执行并进入运行态。"
    交付物:
      - "createHaloContainer 通过"
      - "haloServer 启动流程通过"
      - "计划状态回写完成"
    备注: "容器已成功创建并运行（`docker ps` 显示 `halo-for-plugin-development` Up，映射 `8090->8090`）；日志确认 `plugin-schedule` 已启动。重复执行 `createHaloContainer/haloServer` 前需先 `gradlew removeHaloContainer`。"

  - 编号: M40
    标记: 管理端优化
    标题: 事件日期精度与页面分区重排
    状态: 已完成
    优先级: 高
    描述: "将事件时间输入改为按天精度，并优化后台页面排版与功能分区。"
    交付物:
      - "事件开始/结束输入改为日期级别"
      - "事件页面样式重排（列表、基础信息、关联文章、高亮规则）"
      - "日历配置页面样式统一优化"
    备注: "已将事件开始/结束输入改为按天（type=date），保存时转换为 ISO 日期边界；并重排后台页面分区与排版（功能导航、事件列表、基础信息、关联文章、高亮规则），日历配置页同步优化并展示事件范围。"

  - 编号: M41
    标记: 回归验收
    标题: 构建与后台交互验证
    状态: 已完成
    优先级: 高
    描述: "执行构建并验证按天输入与后台样式优化结果。"
    交付物:
      - "gradlew build 通过"
      - "事件表单按天输入可用"
      - "后台排版分区清晰"
    备注: "已通过 `gradlew build`；Chrome MCP 验证日程事件表单为按天输入（开始/结束日期），事件列表展示为日期列；日历配置与事件页面已按功能分区重排，导航与切换区样式统一。"
